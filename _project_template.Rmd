---
title: "`r params$project_name`"
output: html_document
params:
  project_name: "Project Template"
  project_key: "500-block-dumbbell-development"
  # project_name: "nice-potted-plants-on-street"
  # project_key: "nice-potted-plants-on-street"
  # project_name: "3 Story Multi-family behind Staples above enclosed parking garage"
  # project_key: "3-story-multi-family-behind-staples-above-enclosed-parking-garage"
  # project_name: "RSP Design Hub"
  # project_key: "rsp-design-hub"
  #project_name: "Nice potted plants on street"
  #project_key: "nice-potted-plants-on-street"
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, warning = F, message = F)
```

```{r project}
source("functions.R")

# params <- list(
  # project_key = "stakeholder")
  # project_key = "500-block-dumbbell-development")

project <<- read_csv(projects_csv) %>% 
  filter(project_key == params$project_key) %>%
  mutate(
    Submitted = as_datetime(
      Timestamp, 
      format = "%m/%d/%Y %H:%M:%S", tz="America/Los_Angeles")    
  )
```

# {.tabset}

## Overview

<!-- multi-column layout -->
:::: {style="display: flex;"}

<!-- 1st div on left -->
::: {}

`r fld2str("Project Description")`

`r fld2str("Type of Vision")`

**Team:** [`r project$team_name`](`r glue("./team_{project$team_key}.html")`)

`r fld2str("Design Standards Affected")`

`r fld2str("Existing Land Use")`

`r fld2str("Proposed Land Use")`

`r fld2str("Submitted", "Submitted on")`

:::

<!-- 2nd div on right -->
::: {} 

```{r map}
source("functions.R")

area_plys <- get_area_plys()

project_ply <- area_plys %>% 
  filter(area_key == project$area_key)

if (is.na(project$area_key)){
    notproject_plys <- area_plys
} else {
  notproject_plys <- area_plys %>% 
    filter(area_key != project$area_key)
}

notproject_labels <- notproject_plys$label_html

map <- leaflet(width=300, height=300) %>% 
  addProviderTiles(providers$Stamen.TonerLite, group = "Black & white",
    options = providerTileOptions(
      attribution = "", 
      opacity = 0.5)) %>% 
  addProviderTiles(
    providers$CartoDB.Voyager, group = "Streets",
    options = providerTileOptions(opacity = 0.8)) %>%
  addProviderTiles(providers$Esri.WorldImagery, group = "Satellite",
    options = providerTileOptions(opacity = 0.5)) %>% 
  addPolygons(
    data = notproject_plys,
    group = "Other Areas",
    color     = ~color, opacity     = 0.3, weight = 0.5,
    fillColor = ~color, fillOpacity = 0.1,
    label = lapply(notproject_labels, HTML), popup = ~popup_html) %>%
  addLayersControl(
    baseGroups = c("Black & white", "Streets", "Satellite"),
    overlayGroups = c("Project Area", "Other Areas"),
    options = layersControlOptions(collapsed = T))

if (nrow(project_ply) ==1){
  project_label <- project_ply$label_html
  b             <- st_bbox(notproject_plys)  

  map <- map %>% 
    addPolygons(
      data = project_ply,
      group = "Project Area",
      color     = ~color, opacity     = 0.9, weight = 2,
      fillColor = ~color, fillOpacity = 0.6,
      label = lapply(project_label, HTML), popup = ~popup_html) %>%
    fitBounds(b[['xmin']], b[['ymin']], b[['xmax']], b[['ymax']])
}
map
```

`r fld2str("area_name", "Focus Area")`

`r fld2str("Specific Address (if applicable)", "Specific Address")`

`r fld2str("area_name", "Focus Area")`

`r fld2str("Add New Area or Boundary to Map")`

`r fld2str("Describe Boundary")`

Spatial reference files:

```{r spatial, results='asis'}
d <- read_csv(files_csv) %>% 
  filter(
    project_key == params$project_key,
    file_category == "spatial")

if (nrow(d) > 0){
  d %>% 
  mutate(
    li_md = glue("* [{fname}]({path})")) %>% 
  pull(li_md)
}
```

:::

<!-- end: multi-column layout -->
:::: 

```{r image_overview}
d <- read_csv(files_csv) %>% 
  filter(
    project_key == params$project_key,
    file_category == "image_overview")

if (nrow(d) == 1)
  include_graphics(d$path)
```

## Documents

```{r documents, results='asis'}
docs <- read_csv(files_csv) %>% 
  filter(
    project_key == params$project_key,
    file_category == "documents")

if (nrow(docs) > 0){
  docs %>% 
  mutate(
    li_md = glue("* [{fname}]({path})")) %>% 
  pull(li_md)
}
```

## Images

```{r image_gallery}
library(bsplus)

d <- read_csv(files_csv) %>% 
  filter(
    project_key == params$project_key,
    file_category == "images")

if (nrow(d) > 0)
  paths2carousel(d$path)
```

## Sustainability

`r fld2str("Cost Range")`

`r fld2str("Time frame for societal ROI")`

`r fld2str("What kinds of multi-benefit, performance driven improvements would result from this project, with respect to resource management, energy efficiency, life cycle costs, avoided costs, etc?", "Multi-benefits")`

`r fld2str("What specific ecosystem services will be created, expanded or supported as a result of this project?", "Ecosystem services")`

## Housing

`r fld2str("parcel size (square feet)")`

`r fld2str("setbacks")`

`r fld2str("building height (feet)")`

`r fld2str("# demo units")`

`r fld2str("# new units")`

`r fld2str("If this proposal requires additional amendments to the downtown development standards, please justify those changes below.", "Design standards justification for amendment(s)")`

`r fld2str("total units")`

`r fld2str("density (units/acre)")`

`r fld2str("average unit size (square feet)")`

`r fld2str("total stories")`

`r fld2str("# residential stories")`

`r fld2str("studio units")`

`r fld2str("micro units (less than 400 square feet)")`

`r fld2str("1-bedroom units")`

`r fld2str("2-bedroom units")`

`r fld2str("3+ bedroom units")`

`r fld2str("inclusionary units")`

`r fld2str("alternate open yard")`

`r fld2str("gross building floor area (square feet)")`

`r fld2str("gross building FAR")`

`r fld2str("net rentable floor area (square feet)")`

`r fld2str("net rentable FAR")`

`r fld2str("Development Standards affected")`

## Parking

`r fld2str("public parking spaces", "Public Parking Spaces")`

`r fld2str("commercial parking spaces")`

`r fld2str("residential parking spaces")`

`r fld2str("total parking spaces")`

`r fld2str("Is a podium proposed?", "Podium")`

`r fld2str("If a podium is proposed, what is its approx. area?", "Podium Area")`

`r fld2str("Is underground parking proposed?", "Underground")`

`r fld2str("If underground parking is being proposed, what is its approx. area?", "Underground Area")`

`r fld2str("Is a multi-level parking garage being proposed?", "Multi-level Garage")`

`r fld2str("If multi-level parking is proposed, what is its approx. area?", "Garage Area")`

`r fld2str("Will stacked car lifts be incorporated?", "Stacked Lifts")`

## References

Reference files, inspirational images, etc.:

```{r references, results='asis'}
d <- read_csv(files_csv) %>% 
  filter(
    project_key == params$project_key,
    file_category == "references")

if (nrow(d) > 0){
  d %>% 
  mutate(
    li_md = glue("* [{fname}]({path})")) %>% 
  pull(li_md)
}
```

`r fld2str("Web references (paste url's here)", "Web references")`

