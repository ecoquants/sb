---
title: "AIA Charrette 2020 for Santa Barbara"
subtitle: "_re invigorate, re invent, re imagine, re purpose_"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, warning = F, message = F)
```

## Map

```{r}
source("functions.R")

area_plys <- get_area_plys()

main_areas <- area_plys %>% 
      filter(layer == "Main Focus Areas")
other_areas <- area_plys %>% 
      filter(layer == "Additional Focus Areas")
main_labels  <- main_areas$label_html
other_labels <- other_areas$label_html

leaflet( width = "100%") %>% 
  addProviderTiles(providers$Stamen.TonerLite, group = "Black & white",
    options = providerTileOptions(opacity = 0.5)) %>% 
  addProviderTiles(
    providers$CartoDB.Voyager, group = "Streets",
    options = providerTileOptions(opacity = 0.8)) %>%
  addProviderTiles(providers$Esri.WorldImagery, group = "Satellite",
    options = providerTileOptions(opacity = 0.5)) %>% 
  addPolygons(
    data = main_areas,
    group = "Main Focus Areas",
    color     = ~color, opacity     = 0.9, weight = 0.5,
    fillColor = ~color, fillOpacity = 0.6,
    label = lapply(main_labels, HTML), popup = ~popup_html) %>%
  addPolygons(
    data = other_areas,
    group = "Additional Focus Areas",
    color     = ~color, opacity     = 0.6, weight = 0.5,
    fillColor = ~color, fillOpacity = 0.3,
    label = lapply(other_labels, HTML), popup = ~popup_html) %>%
  addLayersControl(
    baseGroups = c("Black & white", "Streets", "Satellite"),
    overlayGroups = c("Main Focus Areas", "Additional Focus Areas"),
    options = layersControlOptions(collapsed = T))
```

## Projects

```{r}
projects <- read_csv(projects_csv) %>% 
  left_join(
    read_csv(teams_csv) %>% 
      select(team_key, team_htm),
    by = "team_key") %>% 
  mutate(
    Submitted = as_datetime(
      Timestamp, 
      format = "%m/%d/%Y %H:%M:%S", tz="America/Los_Angeles"),
    Project   = glue("<a href={project_htm}>{Title}</a>"), 
    Team      = glue("<a href={team_htm}>{team_name}</a>")) %>% 
  select(Area = area_name, Project, Team, Submitted)

datatable(
  projects, 
  escape = F,
  plugins = 'natural', options = list(
    dom = 't',
    columnDefs = list(list(
      type = 'natural', targets = "_all")))) %>% 
    formatDate("Submitted", method = "toLocaleString")
    # method = "toLocaleString",
    # params = list("se", list(timeZone = "America/Los_Angeles")))

```
